/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var m=Object.defineProperty;var E=Object.getOwnPropertyDescriptor;var T=Object.getOwnPropertyNames;var P=Object.prototype.hasOwnProperty;var D=(a,i)=>{for(var t in i)m(a,t,{get:i[t],enumerable:!0})},b=(a,i,t,e)=>{if(i&&typeof i=="object"||typeof i=="function")for(let n of T(i))!P.call(a,n)&&n!==t&&m(a,n,{get:()=>i[n],enumerable:!(e=E(i,n))||e.enumerable});return a};var k=a=>b(m({},"__esModule",{value:!0}),a);var V={};D(V,{default:()=>u});module.exports=k(V);var l=require("obsidian"),h="similar-notes-view",L={en:{viewTitle:"Similar Notes",settingsTitle:"Similar Notes Search Settings",excludedFoldersName:"Excluded Folders",excludedFoldersDesc:"Specify folders (comma-separated) to exclude from search",minNoteLengthName:"Minimum Note Length",minNoteLengthDesc:"Minimum number of characters in a note to include it in search",searchingNotes:"Searching for similar notes...",noSimilarNotes:"No similar notes found",errorSearching:"Error searching for similar notes",commandName:"Find similar notes",errorCreatingPanel:"Failed to create panel",pluginLoaded:"Plugin loaded!",pluginUnloaded:"Plugin unloaded!",simularyText:"Similarity: {{value}}%"},de:{viewTitle:"\xC4hnliche Notizen",settingsTitle:"Einstellungen f\xFCr \xE4hnliche Notizen",excludedFoldersName:"Ausgeschlossene Ordner",excludedFoldersDesc:"Geben Sie durch Kommas getrennte Ordner an, die von der Suche ausgeschlossen werden sollen",minNoteLengthName:"Minimale Notizl\xE4nge",minNoteLengthDesc:"Minimale Anzahl von Zeichen in einer Notiz, um sie in die Suche einzubeziehen",searchingNotes:"Suche nach \xE4hnlichen Notizen...",noSimilarNotes:"Keine \xE4hnlichen Notizen gefunden",errorSearching:"Fehler bei der Suche nach \xE4hnlichen Notizen",commandName:"\xC4hnliche Notizen finden",errorCreatingPanel:"Panel konnte nicht erstellt werden",pluginLoaded:"Plugin geladen!",pluginUnloaded:"Plugin entladen!",simularyText:"\xC4hnlichkeit: {{value}}%"},fr:{viewTitle:"Notes similaires",settingsTitle:"Param\xE8tres de recherche de notes similaires",excludedFoldersName:"Dossiers exclus",excludedFoldersDesc:"Sp\xE9cifiez les dossiers (s\xE9par\xE9s par des virgules) \xE0 exclure de la recherche",minNoteLengthName:"Longueur minimale de la note",minNoteLengthDesc:"Nombre minimum de caract\xE8res dans une note pour l'inclure dans la recherche",searchingNotes:"Recherche de notes similaires...",noSimilarNotes:"Aucune note similaire trouv\xE9e",errorSearching:"Erreur lors de la recherche de notes similaires",commandName:"Trouver des notes similaires",errorCreatingPanel:"Impossible de cr\xE9er le panneau",pluginLoaded:"Plugin charg\xE9 !",pluginUnloaded:"Plugin d\xE9charg\xE9 !",simularyText:"Similarit\xE9: {{value}}%"},ru:{viewTitle:"\u041F\u043E\u0445\u043E\u0436\u0438\u0435 \u0437\u0430\u043C\u0435\u0442\u043A\u0438",settingsTitle:"\u041D\u0430\u0441\u0442\u0440\u043E\u0439\u043A\u0438 \u043F\u043E\u0438\u0441\u043A\u0430 \u043F\u043E\u0445\u043E\u0436\u0438\u0445 \u0437\u0430\u043C\u0435\u0442\u043E\u043A",excludedFoldersName:"\u0418\u0441\u043A\u043B\u044E\u0447\u0435\u043D\u043D\u044B\u0435 \u043F\u0430\u043F\u043A\u0438",excludedFoldersDesc:"\u0423\u043A\u0430\u0436\u0438\u0442\u0435 \u043F\u0430\u043F\u043A\u0438 \u0447\u0435\u0440\u0435\u0437 \u0437\u0430\u043F\u044F\u0442\u0443\u044E, \u0432 \u043A\u043E\u0442\u043E\u0440\u044B\u0445 \u043D\u0435 \u043D\u0443\u0436\u043D\u043E \u0438\u0441\u043A\u0430\u0442\u044C \u043F\u043E\u0445\u043E\u0436\u0438\u0435 \u0437\u0430\u043C\u0435\u0442\u043A\u0438",minNoteLengthName:"\u041C\u0438\u043D\u0438\u043C\u0430\u043B\u044C\u043D\u0430\u044F \u0434\u043B\u0438\u043D\u0430 \u0437\u0430\u043C\u0435\u0442\u043A\u0438",minNoteLengthDesc:"\u041C\u0438\u043D\u0438\u043C\u0430\u043B\u044C\u043D\u043E\u0435 \u043A\u043E\u043B\u0438\u0447\u0435\u0441\u0442\u0432\u043E \u0441\u0438\u043C\u0432\u043E\u043B\u043E\u0432 \u0432 \u0437\u0430\u043C\u0435\u0442\u043A\u0435 \u0434\u043B\u044F \u0435\u0451 \u0443\u0447\u0451\u0442\u0430 \u0432 \u043F\u043E\u0438\u0441\u043A\u0435",searchingNotes:"\u041F\u043E\u0438\u0441\u043A \u043F\u043E\u0445\u043E\u0436\u0438\u0445 \u0437\u0430\u043C\u0435\u0442\u043E\u043A...",noSimilarNotes:"\u041F\u043E\u0445\u043E\u0436\u0438\u0445 \u0437\u0430\u043C\u0435\u0442\u043E\u043A \u043D\u0435 \u043D\u0430\u0439\u0434\u0435\u043D\u043E",errorSearching:"\u041F\u0440\u043E\u0438\u0437\u043E\u0448\u043B\u0430 \u043E\u0448\u0438\u0431\u043A\u0430 \u043F\u0440\u0438 \u043F\u043E\u0438\u0441\u043A\u0435 \u043F\u043E\u0445\u043E\u0436\u0438\u0445 \u0437\u0430\u043C\u0435\u0442\u043E\u043A",commandName:"\u041D\u0430\u0439\u0442\u0438 \u043F\u043E\u0445\u043E\u0436\u0438\u0435 \u0437\u0430\u043C\u0435\u0442\u043A\u0438",errorCreatingPanel:"\u041D\u0435 \u0443\u0434\u0430\u043B\u043E\u0441\u044C \u0441\u043E\u0437\u0434\u0430\u0442\u044C \u043F\u0430\u043D\u0435\u043B\u044C",pluginLoaded:"\u041F\u043B\u0430\u0433\u0438\u043D \u0437\u0430\u0433\u0440\u0443\u0436\u0435\u043D!",pluginUnloaded:"\u041F\u043B\u0430\u0433\u0438\u043D \u0432\u044B\u0433\u0440\u0443\u0436\u0435\u043D!",simularyText:"\u0421\u0445\u043E\u0436\u0435\u0441\u0442\u044C: {{value}}%"}},C={excludedFolders:["Files"],minNoteLength:10};function p(a){var t;let i={};for(let e of a){let n=e.split(/\W+/),o=n.length;for(let s of n){let c=s.toLowerCase();i[c]||(i[c]={count:0,docs:new Set,tf:0}),i[c].count++,(t=i[c].docs)==null||t.add(e)}for(let s in i)i[s].tf=i[s].count/o}return i}function z(a,i){let t={};for(let e in a)t[e]=Math.log(i/a[e].docs.size);return t}function v(a,i){let t={};for(let e in a)t[e]=a[e].tf*i[e];return t}function M(a,i){let t=Object.keys(a).reduce((o,s)=>o+(a[s]||0)*(i[s]||0),0),e=Math.sqrt(Object.keys(a).reduce((o,s)=>o+(a[s]||0)**2,0)),n=Math.sqrt(Object.keys(i).reduce((o,s)=>o+(i[s]||0)**2,0));return t/(e*n)}var f=class extends l.ItemView{constructor(t,e){super(t);this.plugin=e,this.container=this.containerEl.createDiv({cls:"similar-notes-container"})}getViewType(){return h}getDisplayText(){return this.plugin.getLocale().viewTitle}async onOpen(){let{containerEl:t}=this;t.empty(),t.createEl("h4",{text:this.plugin.getLocale().viewTitle}),this.contentEl=t.createDiv({cls:"similar-notes-content"}),this.loadingEl=t.createDiv({cls:"similar-notes-loading",text:this.plugin.getLocale().searchingNotes}),this.loadingEl.hide()}async onClose(){this.contentEl.empty()}showLoading(){this.loadingEl.show(),this.contentEl.hide()}hideLoading(){this.loadingEl.hide(),this.contentEl.show()}async updateView(t){if(this.contentEl){if(this.contentEl.empty(),t.length===0){this.contentEl.createEl("div",{cls:"similar-notes-empty",text:this.plugin.getLocale().noSimilarNotes});return}for(let e of t.slice(0,20)){let n=this.contentEl.createEl("div",{cls:"similar-note-row"});n.createEl("a",{text:e.document,cls:"similar-note-link"}).addEventListener("click",async s=>{s.preventDefault();let c=this.plugin.app.vault.getAbstractFileByPath(e.document);c instanceof l.TFile&&await this.plugin.app.workspace.getLeaf("tab").openFile(c)}),n.createEl("span",{text:this.plugin.getLocale().simularyText.replace("{{value}}",(e.similarity*100).toFixed(2)),cls:"similar-note-similarity"})}}}},u=class extends l.Plugin{getLocale(){let e=(window.localStorage.getItem("language")||"en").split("-")[0].toLowerCase();return L[e]||L.en}async onload(){await this.loadSettings(),console.log(this.getLocale().pluginLoaded),this.addSettingTab(new w(this.app,this)),this.registerView(h,e=>this.view=new f(e,this)),this.registerEvent(this.app.workspace.on("file-open",async e=>{if(e&&this.view){let n=await this.app.vault.read(e);await this.findNotes(n)}})),this.addCommand({id:"find-notes",name:this.getLocale().commandName,callback:async()=>{let e=await this.getCurrentFileContent();await this.activateView(),await this.findNotes(e)}}),this.app.workspace.onLayoutReady(async()=>{await this.activateView();let e=this.app.workspace.getActiveFile();if(e){let n=await this.app.vault.read(e);await this.findNotes(n)}});let t=this.app.workspace.getActiveFile();if(t){let e=await this.app.vault.read(t);await this.activateView(),await this.findNotes(e)}}async activateView(){try{let{workspace:t}=this.app,e=t.getLeavesOfType(h)[0];if(!e){let n=t.rightSplit;n&&n.collapsed&&n.expand();let o=t.getRightLeaf(!1);if(!o)throw new Error(this.getLocale().errorCreatingPanel);e=o,await e.setViewState({type:h,active:!0})}return t.revealLeaf(e),e}catch(t){throw console.error(this.getLocale().errorCreatingPanel,t),t}}async getCurrentFileContent(){let t=this.app.workspace.getActiveFile();return t?await this.app.vault.read(t):""}async findNotes(t){if(this.view){this.view.showLoading();try{let n=this.app.vault.getFiles().filter(r=>r.name.endsWith(".md")&&!this.settings.excludedFolders.some(d=>r.path.startsWith(d))),o=[t];for(let r of n){let d=this.app.vault.getFileByPath(r.path);if(!d)continue;let g=await this.app.vault.read(d);g.length>=this.settings.minNoteLength&&o.push(`${r.path}
${g}`)}let s=o,c=p(s),N=z(c,s.length),S=s.map(r=>v(p([r]),N)),F=v(p([t]),N),x=S.map((r,d)=>{var g,y;return{document:(y=(g=n[d])==null?void 0:g.path)!=null?y:d,similarity:M(r,F)}}).filter(r=>r.similarity<1).sort((r,d)=>d.similarity-r.similarity);this.view.updateView(x)}catch(e){console.error("\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0440\u0438 \u043F\u043E\u0438\u0441\u043A\u0435 \u043F\u043E\u0445\u043E\u0436\u0438\u0445 \u0437\u0430\u043C\u0435\u0442\u043E\u043A:",e),this.view.contentEl.empty(),this.view.contentEl.createEl("div",{cls:"similar-notes-error",text:this.getLocale().errorSearching})}finally{this.view.hideLoading()}}}async onunload(){console.log(this.getLocale().pluginUnloaded);let t=this.app.workspace.getLeavesOfType(h);for(let e of t)await e.detach()}async loadSettings(){this.settings=Object.assign({},C,await this.loadData())}async saveSettings(){await this.saveData(this.settings)}},w=class extends l.PluginSettingTab{constructor(t,e){super(t,e);this.plugin=e}display(){let{containerEl:t}=this,e=this.plugin.getLocale();t.empty(),t.createEl("h2",{text:e.settingsTitle}),new l.Setting(t).setName(e.excludedFoldersName).setDesc(e.excludedFoldersDesc).addText(n=>n.setPlaceholder("Files, Archive, Templates").setValue(this.plugin.settings.excludedFolders.join(", ")).onChange(async o=>{this.plugin.settings.excludedFolders=o.split(",").map(s=>s.trim()).filter(s=>s.length>0),await this.plugin.saveSettings()})),new l.Setting(t).setName(e.minNoteLengthName).setDesc(e.minNoteLengthDesc).addText(n=>n.setPlaceholder("10").setValue(String(this.plugin.settings.minNoteLength)).onChange(async o=>{let s=Number(o);!isNaN(s)&&s>0&&(this.plugin.settings.minNoteLength=s,await this.plugin.saveSettings())}))}};
